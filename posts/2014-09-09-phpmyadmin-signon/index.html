<!doctype html><html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>PHP MyAdmin 改造实现单点登录 - Du, Chengbin's Blog</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta itemprop=name content="PHP MyAdmin 改造实现单点登录">
<meta itemprop=description content="PHP MyAdmin 单点登录的实质就是不要 PHP MyAdmin 默认的登录认证方式，而使用自己网站程序的认证系统，这样就实现了单点登录。PHP MyAdmin里面提供了一种 signon 的模式来做这件事。"><meta itemprop=datePublished content="2014-09-09T00:00:00+08:00">
<meta itemprop=dateModified content="2014-09-09T00:00:00+08:00">
<meta itemprop=wordCount content="61">
<meta itemprop=keywords content="工作,"><meta property="og:title" content="PHP MyAdmin 改造实现单点登录">
<meta property="og:description" content="PHP MyAdmin 单点登录的实质就是不要 PHP MyAdmin 默认的登录认证方式，而使用自己网站程序的认证系统，这样就实现了单点登录。PHP MyAdmin里面提供了一种 signon 的模式来做这件事。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dcb9.github.io/posts/2014-09-09-phpmyadmin-signon/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-09-09T00:00:00+08:00">
<meta property="article:modified_time" content="2014-09-09T00:00:00+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="PHP MyAdmin 改造实现单点登录">
<meta name=twitter:description content="PHP MyAdmin 单点登录的实质就是不要 PHP MyAdmin 默认的登录认证方式，而使用自己网站程序的认证系统，这样就实现了单点登录。PHP MyAdmin里面提供了一种 signon 的模式来做这件事。">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700" rel=stylesheet type=text/css>
<link rel=stylesheet type=text/css media=screen href=https://dcb9.github.io/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=https://dcb9.github.io/css/main.css>
<link rel=stylesheet type=text/css href=https://dcb9.github.io/css/katex.min.css>
<link id=dark-scheme rel=stylesheet type=text/css href=https://dcb9.github.io/css/dark.css>
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<script src=https://dcb9.github.io/js/main.js></script><script src=https://dcb9.github.io/js/katex.min.js></script><script src=https://dcb9.github.io/js/auto-render.min.js></script><script src=https://dcb9.github.io/js/custom.js></script>
</head>
<body>
<div class="container wrapper">
<div class=header>
<h1 class=site-title><a href=https://dcb9.github.io/>Du, Chengbin's Blog</a></h1>
<div class=site-description><p>Software engineer</p><nav class="nav social">
<ul class=flat><li><a href=https://github.com/dcb9 title=Github><i data-feather=github></i></a></li><li><a href=https://twitter.com/robertduu title=Twitter><i data-feather=twitter></i></a></li><li><a href=/index.xml title=RSS><i data-feather=rss></i></a></li></ul>
</nav>
</div>
<nav class=nav>
<ul class=flat>
<li>
<a href=/>Home</a>
</li>
<li>
<a href=/posts>All posts</a>
</li>
<li>
<a href=/about>About</a>
</li>
<li>
<a href=/tags>Tags</a>
</li>
</ul>
</nav>
</div>
<div class=post>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>09</span>
<span class=rest>Sep 2014</span>
</div>
</div>
<div class=matter>
<h1 class=title>PHP MyAdmin 改造实现单点登录</h1>
</div>
</div>
<div class=markdown>
<h4 id=修改配置文件>修改配置文件</h4>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:green>/* FILE: config.inc.php */</span>

$cfg[<span style=color:#a31515>&#39;Servers&#39;</span>][$i][<span style=color:#a31515>&#39;auth_type&#39;</span>] = <span style=color:#a31515>&#39;signon&#39;</span>;
$cfg[<span style=color:#a31515>&#39;Servers&#39;</span>][$i][<span style=color:#a31515>&#39;SignonSession&#39;</span>] = <span style=color:#a31515>&#39;SignonSession&#39;</span>; <span style=color:green>// 为了防止多个session的键的冲突，所以单独设置 个session名称
</span><span style=color:green></span>$cfg[<span style=color:#a31515>&#39;Servers&#39;</span>][$i][<span style=color:#a31515>&#39;SignonURL&#39;</span>] = <span style=color:#a31515>&#39;/signon.php&#39;</span>; <span style=color:green>// 自定义登录页面
</span><span style=color:green></span>$cfg[<span style=color:#a31515>&#39;Servers&#39;</span>][$i][<span style=color:#a31515>&#39;LogoutURL&#39;</span>] = <span style=color:#a31515>&#39;/signon.php?logout=1&#39;</span>; <span style=color:green>// 自定义登录页面的退出页面
</span></code></pre></div><h4 id=配置登录程序>配置登录程序</h4>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:green>/* FILE: /signon.php */</span>

<span style=color:#00f>if</span> (isset($_GET[<span style=color:#a31515>&#39;logout&#39;</span>])) {
    session_destroy();
    header(<span style=color:#a31515>&#39;Location: 网站原来的退出url&#39;</span>);
    <span style=color:#00f>exit</span>;
}

$userDb = <span style=color:#00f>array</span>(
    <span style=color:#a31515>&#39;单点登录后的用户名或id号&#39;</span> =&gt; <span style=color:#a31515>&#39;给这个人分配的数据库的用户名&#39;</span>,
);

<span style=color:green>// MySQL 中添加用户的时候密码为空就行。然后主要就是对于现在系统的用户名和数据库的用户名的一个映射，
</span><span style=color:green>// 也可以就用现在的用户名作为数据库的用户名，不过得保证字符长度不得大于16，
</span><span style=color:green>// 中文的用户名我也没弄过，如果弄中文的可能也会出问题。
</span><span style=color:green></span>
$_SESSION[<span style=color:#a31515>&#39;PMA_single_signon_user&#39;</span>] = $userDb[$cookieofmanagername]; <span style=color:green>// 这个用户名一定要数据库存在并有相应的权限的。
</span><span style=color:green></span>$_SESSION[<span style=color:#a31515>&#39;PMA_single_signon_password&#39;</span>] = <span style=color:#a31515>&#39;&#39;</span>;

<span style=color:#00f>echo</span> <span style=color:#a31515>&#34;&lt;script&gt;top.location.href=&#39;/phpmyadmin/index.php&#39;;&lt;/script&gt;&#34;</span>;
</code></pre></div>
</div>
<div class=tags>
<ul class=flat>
<li><a href=/tags/%E5%B7%A5%E4%BD%9C>工作</a></li>
</ul>
</div></div>
</div>
<div class="footer wrapper">
<nav class=nav>
<div>2022 © Copyright Du, Chengbin | <a href=https://github.com/knadh/hugo-ink>Ink</a> theme on <a href=https://gohugo.io>Hugo</a></div>
</nav>
</div>
<script>feather.replace()</script>
</body>
</html>