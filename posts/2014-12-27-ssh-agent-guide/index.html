<!doctype html><html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>ssh-agent 使用指南 - Du, Chengbin's Blog</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta itemprop=name content="ssh-agent 使用指南">
<meta itemprop=description content="不知道你有没有遇到这样的情况，有二台以上的服务器(服务器系统是 windows 的不要往下看)需要管理，如果说你有这种情况，而且还没有用到 `ssh-agent` 的话，那么这篇文章就是为你而写。"><meta itemprop=datePublished content="2014-12-27T00:00:00+08:00">
<meta itemprop=dateModified content="2014-12-27T00:00:00+08:00">
<meta itemprop=wordCount content="76">
<meta itemprop=keywords content="Shell,"><meta property="og:title" content="ssh-agent 使用指南">
<meta property="og:description" content="不知道你有没有遇到这样的情况，有二台以上的服务器(服务器系统是 windows 的不要往下看)需要管理，如果说你有这种情况，而且还没有用到 `ssh-agent` 的话，那么这篇文章就是为你而写。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dcb9.github.io/posts/2014-12-27-ssh-agent-guide/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-12-27T00:00:00+08:00">
<meta property="article:modified_time" content="2014-12-27T00:00:00+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="ssh-agent 使用指南">
<meta name=twitter:description content="不知道你有没有遇到这样的情况，有二台以上的服务器(服务器系统是 windows 的不要往下看)需要管理，如果说你有这种情况，而且还没有用到 `ssh-agent` 的话，那么这篇文章就是为你而写。">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700" rel=stylesheet type=text/css>
<link rel=stylesheet type=text/css media=screen href=https://dcb9.github.io/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=https://dcb9.github.io/css/main.css>
<link rel=stylesheet type=text/css href=https://dcb9.github.io/css/katex.min.css>
<link id=dark-scheme rel=stylesheet type=text/css href=https://dcb9.github.io/css/dark.css>
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<script src=https://dcb9.github.io/js/main.js></script><script src=https://dcb9.github.io/js/katex.min.js></script><script src=https://dcb9.github.io/js/auto-render.min.js></script><script src=https://dcb9.github.io/js/custom.js></script>
</head>
<body>
<div class="container wrapper">
<div class=header>
<h1 class=site-title><a href=https://dcb9.github.io/>Du, Chengbin's Blog</a></h1>
<div class=site-description><p>A software engineer</p><nav class="nav social">
<ul class=flat><li><a href=https://github.com/dcb9 title=Github><i data-feather=github></i></a></li><li><a href=https://twitter.com/robertduu title=Twitter><i data-feather=twitter></i></a></li><li><a href=/index.xml title=RSS><i data-feather=rss></i></a></li></ul>
</nav>
</div>
<nav class=nav>
<ul class=flat>
<li>
<a href=/>Home</a>
</li>
<li>
<a href=/posts>All posts</a>
</li>
<li>
<a href=/about>About</a>
</li>
<li>
<a href=/tags>Tags</a>
</li>
</ul>
</nav>
</div>
<div class=post>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>27</span>
<span class=rest>Dec 2014</span>
</div>
</div>
<div class=matter>
<h1 class=title>ssh-agent 使用指南</h1>
</div>
</div>
<div class=markdown>
<p>不知道你有没有遇到这样的情况，有二台以上的服务器(服务器系统是 windows 的不要往下看)需要管理，如果说你有这种情况，而且还没有用到 <code>ssh-agent</code> 的话，那么这篇文章就是为你而写。</p>
<p>假如你有三台服务器 s1.x.com s2.x.com s3.x.com，而且你都做好了登录到每一台机器的免密码功能。就是通过本地机器直接运行 <code>ssh sN.x.com</code> （注意：<em>N</em>）都可以连接到相应的服务器了，那么问题就来了，如果你现在已经连接到 s1 这台机器上，希望通过 s1 这台机器直接连到 s2 这台机器，并且不要输入密码，你测试了一下发现不行，为什么呢？因为 s1 和 s2 这两台机器没有做免密码登录功能，虽然我们可以把本地的私钥上传到 s1 服务器上，让它连接 s2 的时候就使用这个私钥，但是这样子做太危险了啊，如果有人进了你的系统，你整个内网都是可以直接进入的，因为已经拿到了你的私钥了嘛。<code>ssh-agent</code> 就是一个让你不把私钥上传到服务器上，就可以完成刚才的功能的一个工具，让你在这些服务器之间来去自如。</p>
<h3 id=step1-开启-ssh-agent>step1. 开启 ssh-agent</h3>
<p>$ eval <code>ssh-agent</code>
Agent pid XXX</p>
<h3 id=step2-添加私钥>step2. 添加私钥</h3>
<p>$ ssh-add ~/.ssh/id_rsa （如果生成密钥时是使用的默认的，那么就是这个了，如果不是的话就写你的私钥地址吧）</p>
<h3 id=step3-告诉ssh-允许-ssh-agent-转发>step3. 告诉ssh 允许 ssh-agent 转发</h3>
<ul>
<li>修改全局：</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ echo <span style=color:#a31515>&#34;ForwardAgent yes&#34;</span> &gt;&gt; /etc/ssh/ssh_config
</code></pre></div><ul>
<li>修改个人</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ touch ~/.ssh/config
$ vim ~/.ssh/config
Host *
  ForwardAgent yes
</code></pre></div><h3 id=step4-修改每台服务器的-ssh-配置文件让它们都对-ssh-agent-进行转发>step4. 修改每台服务器的 ssh 配置文件，让它们都对 ssh-agent 进行转发</h3>
<p>到每台服务器上去按 step3 -> 全局，做一下。</p>
<p>现在你可以通过本地连接到任意一台服务器了，通过这台服务器再任意的连接到其它的服务器，以后就可以静静地享受这份快乐了！</p>
</div>
<div class=tags>
<ul class=flat>
<li><a href=/tags/shell>Shell</a></li>
</ul>
</div></div>
</div>
<div class="footer wrapper">
<nav class=nav>
<div>2022 © Copyright Du, Chengbin | <a href=https://github.com/knadh/hugo-ink>Ink</a> theme on <a href=https://gohugo.io>Hugo</a></div>
</nav>
</div>
<script>feather.replace()</script>
</body>
</html>