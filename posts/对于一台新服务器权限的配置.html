<!doctype html>
<html lang="en"> <head> <title>Chengbin Du&#039;s Blog</title> <meta http-equiv="content-type" content="text/html;" charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="//fonts.googleapis.com/css?family=Vollkorn:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" /> <link href="//fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /> <link href= "https://dcb9.github.io/css/style.css" rel="stylesheet" type="text/css" /> <link rel="alternate" href="https://dcb9.github.io/rss.xml" type="application/rss+xml" />  </head> <body> <div class="navigation"> <a href="https://dcb9.github.io">Chengbin Du&#039;s Blog</a> | <a href="/">Home</a>  | <a href="http://github.com/dcb9">GitHub</a>  | <a href="https://twitter.com/robertduu">Twitter</a>  </div> <div id="content"> <div class="article-meta">
<h1 class="title">对于一台新服务器权限的配置</h1>
<div class="tags">
Tagged as <a href="https://dcb9.github.io/tag/工作.html">工作</a> </div>
<div class="date">
Written on 2015-05-29 </div>
</div>
<div class="article-content">
<p>作为一个程序员，在网站没有运维的情况下，也要有能够搭建应用的能力，由于不是专业的运维所以考虑的问题可能不够全面，只顾着把应用搭起来，权限管理非常地松，认为只要登陆 <code>root</code> 可以运行命令就行了，这样的话会有很多后患的，有的时候只是未爆发出来，当爆发出来就已经晚了。</p>

<p>以下是我对一台新服务器的权限的实例，欢迎大家拍砖。</p>

<p>一、技术人员通过自己的普通用户权限进入系统，然后如果要运行需要 <code>root</code> 执行的就用 <code>sudo</code> 去执行就好，如果有多人要登录，则每人配一个帐号。</p>

<p>二、服务器上应该禁止密码登录，因为密码登录有一定的漏洞，有的技术人员设的密码跟没搞过计算机一样来个 <code>123456</code>，这个密码就相当于是个后门了。</p>

<p>三、由于每个人都有了帐号，那么更理所当然的要把 <code>root</code> 用户禁止登录，通过经验得知，如果不禁止，有的人还要登 <code>root</code>，原因可能有以下三点</p>

<ol>
<li>不明白为什么要有普通帐号</li>
<li>对安全看的太轻，认为每次都要 <code>sudo</code> 去运行一个 <code>root</code> 权限才执行的命令很麻烦 
用户管理</li>
<li>可能不懂权限，或许听说过，但绝对没用过</li>
</ol>

<p>四、修改默认 <code>ssh</code> 端口</p>

<h2>添加帐号</h2>

<pre><code>$ useradd bob
$ mkdir -p /home/bob
$ chown -R bob.bob /home/bob

$ gpasswd -a bob sudo // 给用户有 sudo 的权限
$ passwd bob  设置一个密码，这个是作为当用户想要 sudo 去执行 root 执行的时候使用的</code></pre>

<h2>本地配置免密码登录</h2>

<p>本地 <code>ssh-keygen</code> 生成一串密钥</p>

<pre><code>本地 $ ssh-keygen
  /Users/bob/.ssh/some-app-server_id_rsa
  本地 $ ssh-copy-id -i .ssh/some-app-server_rsa bob@remote-server-address
</code></pre>

<p>配置ssh 客户端，方便以后连接服务器。</p>

<pre><code>  本地 $ vim ~/.ssh/config
  Host some-app-server
    Hostname remote-server-address
    User bob
    Port 19422    
    IdentityFile ~/.ssh/some-app-server_id_rsa
</code></pre>

<p>以后连接服务器就可以直接 <code>$ ssh some-app-server</code> 就可以用你的权限登录进去了。</p>

<h2>配置 ssh 服务端</h2>

<pre><code>$ vi /etc/ssh/sshd_config  
PasswordAuthentication no //禁止使用基于口令认证的方式登陆
PubkeyAuthentication yes //允许使用基于密钥认证的方式登陆
Port 19422 // 把 ssh 端口改成 19422 这个别固定，你可以随便用，本地要连接服务器，本地的端口得保持一致。
PermitRootLogin no // 不允许 root 远程登录

重户服务器 $ reboot 使配置生效</code></pre>

<p>本人再推荐一个 <code>zsh</code> 和 <code>oh-my-zsh</code> 有了这个，命令行就智能了好多，操作起来非常地方便，有兴趣的自己去找找文档。</p>

<p align="right"> —— 会一样东西不是本事，从不会到会的，才是真本事</p>
 </div>
<div class="relative-nav">
<a href="https://dcb9.github.io/posts/Docker-VS-虚拟机.html">Previous</a><br>
<a href="https://dcb9.github.io/posts/另一个国内的-Ngrok-服务器分享.html">Next</a><br>
</div>
 </div>  <div class="fineprint"> <hr> Unless otherwise credited all material <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"> <img alt="Creative Commons License" style="border-width:0" src="https://dcb9.github.io/css/cc-by-sa.png" /> </a> by Chengbin Du <a id="coleslaw-logo" href="https://github.com/redline6561/coleslaw"> <img src="https://dcb9.github.io/css/logo_small.jpg" alt="Coleslaw logo" /> </a> </div> </body> </html>