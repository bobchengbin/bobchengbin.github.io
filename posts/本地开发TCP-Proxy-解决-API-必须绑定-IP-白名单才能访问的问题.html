<!doctype html>
<html lang="en"> <head> <title>Chengbin Du&#039;s Blog</title> <meta http-equiv="content-type" content="text/html;" charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="//fonts.googleapis.com/css?family=Vollkorn:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" /> <link href="//fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /> <link href= "https://dcb9.github.io/css/style.css" rel="stylesheet" type="text/css" /> <link rel="alternate" href="https://dcb9.github.io/rss.xml" type="application/rss+xml" />  </head> <body> <div class="navigation"> <a href="https://dcb9.github.io">Chengbin Du&#039;s Blog</a> | <a href="/">Home</a>  | <a href="http://github.com/dcb9">GitHub</a>  | <a href="https://twitter.com/robertduu">Twitter</a>  </div> <div id="content"> <div class="article-meta">
<h1 class="title">本地开发——TCP Proxy 解决 API 必须绑定 IP 白名单才能访问的问题</h1>
<div class="tags">
Tagged as <a href="https://dcb9.github.io/tag/工作.html">工作</a> </div>
<div class="date">
Written on 2015-11-29 </div>
</div>
<div class="article-content">
<p>本次对接一个票务系统的时候，<strong>他们那边的 API 访问需要在白名单的才可以访问</strong>，当时我就提出了个问题</p>

<p>问：那我在本地怎么调试开发啊？（因为我开发机 IP 是不固定的）</p>

<p>答：测试环境也要加，要不然怎么开发呢？</p>

<p>想了一下跟他们争肯定是争不过的了，那就是如何满足他们，想了一下，我有自己的公网服务器 IP，本地测试环境直接请求这台机器，它再把请求转发给相应的 API，这样我不管在哪里都可以开发了。</p>

<p>API 那边的 Host 还是 IP，即 http://x.x.y.z:port/api-route，这样服务端的那里只需要一个 TCP Proxy 就可以了，Google 了一下 <strong><a href="https://github.com/dccmx/tcproxy" >tcproxy</a></strong> 这个小巧的非常入眼。</p>

<h3>安装及使用</h3>

<pre><code>$ git clone https://github.com/dccmx/tcproxy.git
$ cd tcproxy && make ; echo $?  # 输出 0 代表安装成功
$ nohup ./src/tcproxy "0.0.0.0:19999 -&gt; rr{x.x.y.z:port}" &</code></pre>

<p>代码里面的 Host 直接换成我自己的 ip:19999 端口就可以访问了。</p>

<p>使用这个有个注意的点，就是你的代码要有环境之分，不同的环境应可以自定义配置，参考 <a href="http://12factor.net/zh_cn/config" >12 Factor 的配置</a></p>
 </div>
<div class="relative-nav">
<a href="https://dcb9.github.io/posts/另一个国内的-Ngrok-服务器分享.html">Previous</a><br>
<a href="https://dcb9.github.io/posts/Alexander-Makarov-于-CLOUDWAYS-的面试.html">Next</a><br>
</div>
 </div>  <div class="fineprint"> <hr> Unless otherwise credited all material <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"> <img alt="Creative Commons License" style="border-width:0" src="https://dcb9.github.io/css/cc-by-sa.png" /> </a> by Chengbin Du <a id="coleslaw-logo" href="https://github.com/redline6561/coleslaw"> <img src="https://dcb9.github.io/css/logo_small.jpg" alt="Coleslaw logo" /> </a> </div> </body> </html>